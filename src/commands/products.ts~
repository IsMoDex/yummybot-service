import { Context } from 'grammy';
import { getUserProducts } from '../database/queries/product';

export async function productsCommand(ctx: Context) {
    const telegramId = ctx.from?.id;
    if (!telegramId) return ctx.reply('ÐžÑˆÐ¸Ð±ÐºÐ°: Ð½Ðµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»Ð¸Ñ‚ÑŒ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ');

    const products = await getUserProducts(telegramId);

    if (!products || products.length === 0) {
        return ctx.reply('Ð£ Ð²Ð°Ñ Ð¿Ð¾ÐºÐ° Ð½ÐµÑ‚ Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð½Ñ‹Ñ… Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚Ð¾Ð². Ð”Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ Ð¸Ñ… Ñ‡ÐµÑ€ÐµÐ· /add Ð¸Ð»Ð¸ Ð·Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚Ðµ Ñ„Ð¾Ñ‚Ð¾ Ñ‡ÐµÑ€ÐµÐ· /upload ðŸ§Š');
    }

    const list = products
        .map((entry, index) => `${index + 1}. ${entry.product.name}`)
        .join('\n');

    return ctx.reply(`ðŸ§Š *Ð’Ð°ÑˆÐ¸ Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚Ñ‹:*\n\n${list}`, { parse_mode: 'Markdown' });
}
